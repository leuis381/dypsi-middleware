â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                    â•‘
â•‘     ğŸ”§ GUÃA DEFINITIVA DE VARIABLES DE ENTORNO v4.0 ULTRA+         â•‘
â•‘                                                                    â•‘
â•‘              âœ… OCR + BOT CONTROL + FIREBASE FIX                   â•‘
â•‘                                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ VARIABLES REQUERIDAS (5 ESENCIALES)

1ï¸âƒ£ FIREBASE_PROJECT_ID
   - DÃ³nde: Firebase Console â†’ Project Settings
   - Ejemplo: "dypsi-proyecto-xxxxx"
   - DescripciÃ³n: ID Ãºnico de tu proyecto Firebase

2ï¸âƒ£ FIREBASE_CLIENT_EMAIL
   - DÃ³nde: JSON descargado de Service Account
   - Ejemplo: "firebase-adminsdk-xxxxx@dypsi-proyecto.iam.gserviceaccount.com"
   - DescripciÃ³n: Email de la cuenta de servicio

3ï¸âƒ£ FIREBASE_PRIVATE_KEY â­ ARREGLADO
   - DÃ³nde: JSON descargado de Service Account
   - Ejemplo: "-----BEGIN PRIVATE KEY-----\nMIIEvQI...\n-----END PRIVATE KEY-----\n"
   - âœ… AHORA ACEPTA:
     â€¢ Saltos de lÃ­nea reales
     â€¢ Escapados simples (\n)
     â€¢ Escapados dobles (\\n)
     â€¢ Formato Windows (\r\n)
   - NO NECESITAS HACER NADA ESPECIAL - Solo pÃ©galo como estÃ¡

4ï¸âƒ£ KOMMO_API_KEY
   - DÃ³nde: Kommo â†’ ConfiguraciÃ³n â†’ API
   - Ejemplo: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
   - DescripciÃ³n: Token para integraciÃ³n WhatsApp

5ï¸âƒ£ OCR_API_KEY â­ NUEVO
   - Opciones:
     A) OCR.Space (GRATIS - 25 req/dÃ­a)
        URL: https://ocr.space/ocrapi
        Copia el "Free OCR API Key"
     
     B) Google Cloud Vision (PAGO - Ilimitado)
        URL: https://console.cloud.google.com/
        Habilita Cloud Vision API
        Crea API Key
   - DescripciÃ³n: Procesar imÃ¡genes de comprobantes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ VARIABLES OPCIONALES (6 EXTRAS)

6ï¸âƒ£ GOOGLE_MAPS_API_KEY
   - Para: Geocoding y bÃºsqueda de ubicaciones
   - DÃ³nde: Google Cloud Console
   - Habilita: Maps JavaScript API + Geocoding API
   - Opcional: SÃ­

7ï¸âƒ£ STORE_LAT
   - Valor: -12.046374
   - DescripciÃ³n: Latitud de la tienda
   - Opcional: SÃ­

8ï¸âƒ£ STORE_LON
   - Valor: -77.042793
   - DescripciÃ³n: Longitud de la tienda
   - Opcional: SÃ­

9ï¸âƒ£ STORE_NAME
   - Valor: "DYPSI PizzerÃ­a & Grill"
   - DescripciÃ³n: Nombre de la tienda
   - Opcional: SÃ­

ğŸ”Ÿ STORE_PHONE
   - Valor: "+51923883240"
   - DescripciÃ³n: TelÃ©fono de la tienda
   - Opcional: SÃ­

1ï¸âƒ£1ï¸âƒ£ BOT_ENABLED â­ NUEVO - ENCENDIDO/APAGADO
   - Valores: "true" o "false"
   - DescripciÃ³n: Activa/desactiva el bot completamente
   - Default: true
   - Opcional: SÃ­

1ï¸âƒ£2ï¸âƒ£ BOT_MAINTENANCE_MODE â­ NUEVO - MANTENIMIENTO
   - Valores: "true" o "false"
   - DescripciÃ³n: Activa modo mantenimiento
   - Default: false
   - Opcional: SÃ­

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ PASOS PARA CONFIGURAR EN VERCEL

Paso 1: Login en Vercel
â†’ https://vercel.com/dashboard

Paso 2: Seleccionar Proyecto
â†’ Click en "dypsi-middleware"

Paso 3: Settings
â†’ Click en Settings (arriba del proyecto)

Paso 4: Environment Variables
â†’ En el menÃº izquierdo: "Environment Variables"

Paso 5: Agregar Variables
Para cada variable:
  1. Click en "Add Environment Variable"
  2. Name: (nombre exacto)
  3. Value: (tu valor)
  4. Click "Add"

Paso 6: Redeploy
â†’ Vuelve a "Deployments"
â†’ Click en "Redeploy" del Ãºltimo deployment

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ TEMPLATE PARA COPIAR/PEGAR

Copia estas lÃ­neas en Vercel (sin las lÃ­neas vacÃ­as):

FIREBASE_PROJECT_ID
[VALOR AQUÃ]

FIREBASE_CLIENT_EMAIL
[VALOR AQUÃ]

FIREBASE_PRIVATE_KEY
[VALOR AQUÃ - PÃ©galo exactamente como estÃ¡]

KOMMO_API_KEY
[VALOR AQUÃ]

OCR_API_KEY
[VALOR AQUÃ]

GOOGLE_MAPS_API_KEY
[VALOR AQUÃ - OPCIONAL]

STORE_LAT
-12.046374

STORE_LON
-77.042793

STORE_NAME
DYPSI PizzerÃ­a & Grill

STORE_PHONE
+51923883240

BOT_ENABLED
true

BOT_MAINTENANCE_MODE
false

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â­ PROBLEMA RESUELTO: FIREBASE_PRIVATE_KEY

ANTES: "Error: private_key should be a string"
DESPUÃ‰S: âœ… Acepta cualquier formato

El cÃ³digo ahora maneja:
âœ… Saltos de lÃ­nea reales (Ctrl+Enter en editor)
âœ… \n escapado simple
âœ… \\n escapado doble
âœ… \r\n (Windows)

SOLUCIÃ“N: Solo pÃ©galo exactamente como lo copias de Firebase.
No necesitas hacer nada especial.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ›ï¸ NUEVO: CONTROL DEL BOT (Encendido/Apagado)

Endpoints disponibles:

âœ… GET /api/bot/status
   Retorna: Estado actual del bot

âœ… GET /api/bot/health
   Retorna: Health check completo

âœ… POST /api/bot/enable
   AcciÃ³n: Enciende el bot
   Respuesta: {"success": true, "message": "Bot encendido"}

âœ… POST /api/bot/disable
   AcciÃ³n: Apaga el bot
   Respuesta: {"success": true, "message": "Bot apagado"}

âœ… POST /api/bot/maintenance/on
   AcciÃ³n: Activa modo mantenimiento
   Respuesta: {"success": true, "message": "Modo mantenimiento activado"}

âœ… POST /api/bot/maintenance/off
   AcciÃ³n: Desactiva modo mantenimiento
   Respuesta: {"success": true, "message": "Modo mantenimiento desactivado"}

âœ… POST /api/bot/reset
   AcciÃ³n: Resetea contadores
   Respuesta: {"success": true, "message": "Contadores reseteados"}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ§ª VERIFICAR QUE FUNCIONA

Comando 1: Health Check
curl https://tu-proyecto.vercel.app/api/health

Debe retornar status "ok" con todas las variables en "âœ…"

Comando 2: Bot Status
curl https://tu-proyecto.vercel.app/api/bot/status

Debe retornar:
{
  "enabled": true,
  "maintenanceMode": false,
  "available": true,
  "version": "v4.0 ULTRA+"
}

Comando 3: Bot Health
curl https://tu-proyecto.vercel.app/api/bot/health

Debe retornar status "healthy"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… CHECKLIST FINAL

REQUERIDAS:
  â–¡ FIREBASE_PROJECT_ID - Configurada
  â–¡ FIREBASE_CLIENT_EMAIL - Configurada
  â–¡ FIREBASE_PRIVATE_KEY - Configurada (cualquier formato)
  â–¡ KOMMO_API_KEY - Configurada
  â–¡ OCR_API_KEY - Configurada

OPCIONALES (recomendadas):
  â–¡ GOOGLE_MAPS_API_KEY - Configurada
  â–¡ BOT_ENABLED = true
  â–¡ BOT_MAINTENANCE_MODE = false
  â–¡ STORE_LAT y STORE_LON - Configuradas

FINALIZADO:
  â–¡ Redeploy ejecutado en Vercel
  â–¡ /api/health retorna âœ… para todas
  â–¡ /api/bot/status retorna estado correcto
  â–¡ OCR funciona (si tienes imÃ¡genes)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‰ Â¡LISTO!

Tu bot v4.0 ULTRA+ ahora tiene:
âœ… OCR para procesar imÃ¡genes
âœ… Bot control (encendido/apagado)
âœ… Mejor manejo de Firebase keys
âœ… Modo mantenimiento
âœ… Health check

PrÃ³ximo paso: Configura las variables en Vercel y redeploy.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“š MÃ¡s informaciÃ³n: Leer ENV_VARIABLES_COMPLETE.md

VersiÃ³n: v4.0 ULTRA+
Fecha: Febrero 3, 2026
Status: âœ… READY TO DEPLOY
